<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <meta content="https://icyflame.github.io/dp.jpg" property="og:image">

  <meta content="Siddharth Kannan's Blog" property="og:site_name">

  
  <meta content="A response to The Coming Software Apocalypse (an article on The Atlantic)" property="og:title">
  

  
  <meta content="article" property="og:type">
  

  
  <meta content="1496 words about responses" property="og:description">
  

  
  <meta content="https://blog.siddharthkannan.in/2017/10/02/response-to-software-apocalypse/" property="og:url">
  

  
  <meta content="2017-10-02T00:00:00+00:00" property="article:published_time">
  <meta content="https://blog.siddharthkannan.in/about/" property="article:author">
  

  
  
  <meta content="responses" property="article:section">
  
  

  
  
  

  <title>
    
    A response to The Coming Software Apocalypse (an article on The Atlantic) &middot; Siddharth Kannan's Blog
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="https://blog.siddharthkannan.in/public/css/poole.css">
  <link rel="stylesheet" href="https://blog.siddharthkannan.in/public/css/syntax.css">
  <link rel="stylesheet" href="https://blog.siddharthkannan.in/public/css/hyde.css">
  <link rel="stylesheet" href="https://blog.siddharthkannan.in/public/css/custom.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="https://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://blog.siddharthkannan.in/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="https://blog.siddharthkannan.in/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">

  <!-- Google Adsense -->
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
	(adsbygoogle = window.adsbygoogle || []).push({
		google_ad_client: "ca-pub-1148465602033451",
		enable_page_level_ads: true
	});
  </script>
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h2>
        <a href="https://blog.siddharthkannan.in/">
          Siddharth Kannan's Blog
        </a>
      </h2>
      <p class="lead">Programmer | Pianist <br/><a href="http://icyflame.github.io">@icyflame</a></p>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="https://blog.siddharthkannan.in/">Home</a>

      

      
      
        
          
        
      
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://blog.siddharthkannan.in/about/">About</a>
            <!-- about/ -->
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://blog.siddharthkannan.in/list/">List of Posts</a>
            <!-- list/ -->
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://blog.siddharthkannan.in/tag/">List of Posts by Tag</a>
            <!-- tag/ -->
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://blog.siddharthkannan.in/series">List of Series</a>
            <!-- series -->
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://blog.siddharthkannan.in/rss/">RSS</a>
            <!-- rss/ -->
          
        
      

      <span class="sidebar-nav-item">Powered by <a href="https://jekyllrb.com">Jekyll</a>
			  and <a href="https://github.com/poole/hyde">Hyde</a></span>
      <span class="sidebar-nav-item">Hosted on <a href="https://github.com">Github</a></span>
    </nav>

    <p>&copy; 2024. All rights reserved.</p>
  </div>
</div>


    <div class="content container-fluid">
      <div class="post">
  <h1 class="post-title">A response to The Coming Software Apocalypse (an article on The Atlantic)</h1>
  <span class="post-date">02 Oct 2017</span>

  
  <span class="post-date">
  

  
  <a href="https://blog.siddharthkannan.in/tag/#articles">
    articles
  </a>
  
    &middot;
  
  
  <a href="https://blog.siddharthkannan.in/tag/#internet">
    internet
  </a>
  
    &middot;
  
  
  <a href="https://blog.siddharthkannan.in/tag/#responses">
    responses
  </a>
  
    &middot;
  
  
  <a href="https://blog.siddharthkannan.in/tag/#software">
    software
  </a>
  
  
</span>


  
  <p>This is a response to <a href="https://www.theatlantic.com/technology/archive/2017/09/saving-the-world-from-code/540393/">The Coming Software
Apocalypse</a>,
an article on The Atlantic published on 26th September, 2017.</p>

<p>The approach that the article suggests for programming is <a href="https://en.wikipedia.org/wiki/Model-based_design">Model-based
design</a>. I would like to cover
some of my own past experiences with bugs that existed in the code I wrote and
how the lack of confidence in the foolproof-ness of a piece of software leads to
hours spent in thorough (not exhaustive) testing.</p>

<hr />

<h3 id="1-undefined-leads-to-15000-emails">1. <code class="language-plaintext highlighter-rouge">undefined</code> leads to 15,000 emails</h3>

<p>During the past summer at Elanic, there was a typical problem in the ExpressJS
based backend that powered the primary REST API that runs the Elanic mobile
applications. There were three ways for a user to sign-up:</p>

<p>a. Using their Facebook account
b. Using their Google account
c. Using an email ID and a password</p>

<p>(c) was majorly used on the iOS application where OAuth2 logins weren’t yet
implemented. The issue was that when a user signed up using an email ID and a
password, the email ID wasn’t verified. i.e. people could sign up with fake
email IDs like <code class="language-plaintext highlighter-rouge">fake@example.com</code> and get away with it.</p>

<p>Solving this is pretty straight forward. When a user signs up, check if they are
signing up with type (c) and then, send them an email with a link that consists
of a verification token. When they click on the link, we will get the <code class="language-plaintext highlighter-rouge">GET</code>
request and using the token we can mark their account as verified.</p>

<p>If the email ID doesn’t exist or is not controlled by them, then they will never
be able to verify their email. EEZY PEEZY!</p>

<p><img src="https://thumbs.gfycat.com/AffectionateDecisiveEchidna-size_restricted.gif" alt="gif-easy" /></p>

<p>I thought about it a bit more and realised that there is one more case in which
we would want to verify the user’s email and that is in when the user updates
their profile and changes the email from there. In that case as well, we would
have to verify the new email ID. (And if required, send an email to the old
email ID informing them that the email ID has been changed. This wasn’t
required.)</p>

<p>So, now there are two places we want to send the verification email: (a) when
the user signs up with an email (b) when the user updates their email.</p>

<p>Now, the way the code was structured, the <code class="language-plaintext highlighter-rouge">UserProfile</code> model had a function
<code class="language-plaintext highlighter-rouge">UserProfile.updateProfile({ filter, update, options }, callback)</code> and that was the
right place for this code to be. Primarily because <code class="language-plaintext highlighter-rouge">updateProfile</code> was being
called from across the application, and if in the future a flow is introduced
where the email might change from somewhere else, this would take care of it.</p>

<p>So, I wrote something like this.</p>

<p>The routes looked like this (<code class="language-plaintext highlighter-rouge">server.js</code>)</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// POST /users</span>
<span class="c1">// Creating a new user</span>
<span class="kd">function</span> <span class="nf">PostUsers</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">getParams</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">profile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserProfile</span><span class="p">();</span>
  <span class="nx">profile</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>
  <span class="nx">profile</span><span class="p">.</span><span class="nx">password</span> <span class="o">=</span> <span class="nf">hash</span><span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">password</span><span class="p">);</span>
  <span class="nx">profile</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="nx">error</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="nf">sendVerificationEmail</span><span class="p">({</span> <span class="na">email</span><span class="p">:</span> <span class="nx">profile</span><span class="p">.</span><span class="nx">email</span> <span class="p">});</span>
      <span class="nx">response</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="mi">201</span><span class="p">);</span>
      <span class="k">return</span> <span class="nf">next</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="c1">// PUT /users/:id</span>
<span class="c1">// Edit a user's profile</span>
<span class="kd">function</span> <span class="nf">PutUsers</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">response</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">getParams</span><span class="p">;</span>
  <span class="kd">let</span> <span class="nx">userId</span> <span class="o">=</span> <span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

  <span class="kd">let</span> <span class="nx">filter</span> <span class="o">=</span> <span class="p">{</span> <span class="na">_id</span><span class="p">:</span> <span class="nx">userId</span> <span class="p">};</span>
  <span class="kd">let</span> <span class="nx">update</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="nx">params</span><span class="p">,</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">);</span>

  <span class="nx">UserProfile</span><span class="p">.</span><span class="nf">updateProfile</span><span class="p">({</span> <span class="nx">filter</span><span class="p">,</span> <span class="nx">update</span> <span class="p">},</span> <span class="p">(...)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="p">...</span>
    <span class="k">return</span> <span class="nf">next</span><span class="p">();</span>
  <span class="p">});</span>
</code></pre></div></div>

<p>And the model function <code class="language-plaintext highlighter-rouge">updateProfile</code>:</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">UserProfile</span><span class="p">.</span><span class="nx">updateProfile</span> <span class="o">=</span> <span class="p">({</span> <span class="nx">filter</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">options</span> <span class="p">},</span> <span class="nx">callback</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">update</span><span class="p">.</span><span class="nx">email</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">sendVerificationEmail</span><span class="p">({</span> <span class="na">email</span><span class="p">:</span> <span class="nx">update</span><span class="p">.</span><span class="nx">email</span> <span class="p">},</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{});</span>
  <span class="p">}</span>

  <span class="nx">mongo</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nf">callback</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>Since I have spoiled the problems in the code for you, you probably found the
problem?</p>

<p>It’s the first line of <code class="language-plaintext highlighter-rouge">UserProfile.updateProfile</code>! I check if the
<code class="language-plaintext highlighter-rouge">update.email</code> is <code class="language-plaintext highlighter-rouge">undefined</code> or not. While I was writing this, I was convinced
that this will check if the email has changed, because there would be no point
to send the unchanged email alongwith a <code class="language-plaintext highlighter-rouge">PUT</code> call right? Why waste bytes on the
wire for things that haven’t changed?</p>

<p>Well, I got hit right in the face! Turns out <strong>BOTH</strong> the Android and the iOS
application send email alongwith the PUT call and let the backend deal with the
change (or not). Worse still, even PUT calls from an internal tool called the
“administrator panel” also sent this parameter! And internally, profiles are
edited a lot to change tags, etc.</p>

<p>During the next 4 days, there were nearly 15,000 emails sent out of the Mail
exchange. Several frequent users who had their profiles being edited from the
internal tool received the “verify your email” mail multiple times, as high as
20 even.</p>

<p>This was one of the simplest features to implement, but there was still some
nuance! <strong>THAT</strong> is the reason this experience stuck with me, even 3 months
later.</p>

<h3 id="2-my-ongoing-struggle-with-merge-sort">2. My ongoing struggle with Merge Sort</h3>

<p>I have been implementing sorting and those kind of things for quite a while now.
I keep re-implementing them just to keep up-to-date and warmed up in my primary
langauge for competitive programming: C (although I write it in a <code class="language-plaintext highlighter-rouge">.cpp</code> file
and compile it using <code class="language-plaintext highlighter-rouge">g++</code>, more on that later)</p>

<p>Every time I implement Merge sort, I almost always start with the function
signature <code class="language-plaintext highlighter-rouge">int * merge(int *arr, int n)</code> whereas the actual signature should be
<code class="language-plaintext highlighter-rouge">int * merge(int *arr, int begin, int end)</code></p>

<p>The first signature can still be worked, but I like the second one for it’s
verbosity.</p>

<p>Then, you find the middle as <code class="language-plaintext highlighter-rouge">middle = (end + begin) / 2</code> and call merge on the
first and the second halves.</p>

<p>Anyway, there’s no particular bug here, I am just stressing on how although I
know this algorithm inside-out, I still need to write it and test it with a
couple of arrays before I can integrate it into my larger file. (The few times I
was over confident about it and directly started building atop the merge sort I
wrote and thought worked, I spent a significant amount of time going back and
forth and finally realising that I had flaked out in the first function I
wrote!)</p>

<hr />

<p>My final code has been buggy in fairly limited instances. Through the
development process, of course, there are several basic mistakes I make and
discover and fix and move on. The iterative process that is so common is the one
I subscribe to as well.</p>

<p>A couple of points about the article,</p>

<blockquote>
  <p>Newcombe isn’t so sure that it’s the programmer who is to blame. “I’ve heard
from Leslie that he thinks programmers are afraid of math. I’ve found that
programmers aren’t aware—or don’t believe—that math can help them handle
complexity. Complexity is the biggest challenge for programmers.”</p>
</blockquote>

<p>I am not sure what programmer is “afraid” of math. Anyone who comes from an
engineering background or any core science background is almost definitely not
“afraid” of math. If he particularly means Finite Automata and FSMs (which they
talk about in the article as being the holy grail for programming, sort of. Read
the article for the full picture) then even that is incredibly common. Anyone
who has taken an engineering course with an interest in Programming (even those
who don’t have a major in Computer Science) will definitely do a course on
Switching and Finite Automata or Formal Language and Automata or Finite State
Machines themselves!</p>

<p>There was one thing in the article though, which I think appears fiercely to
everyone who writes code for a living:</p>

<blockquote>
  <p>Programmers, as a species, are relentlessly pragmatic</p>
</blockquote>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
    <li>
      <h3>
        <a href="https://blog.siddharthkannan.in/2024/08/31/wireguard-and-mtu-adventure/">
          Adventures with Wireguard and MTU
          <small>31 Aug 2024</small>
        </a>
      </h3>
    </li>
    
    <li>
      <h3>
        <a href="https://blog.siddharthkannan.in/2024/08/29/using-iphone-without-windows-or-apple/">
          Using an iPhone Without Windows or Apple Computers
          <small>29 Aug 2024</small>
        </a>
      </h3>
    </li>
    
    <li>
      <h3>
        <a href="https://blog.siddharthkannan.in/2024/06/12/book-review-delillo-white-noise/">
          Notes and Review - White Noise (DeLillo)
          <small>12 Jun 2024</small>
        </a>
      </h3>
    </li>
    
  </ul>
</div>

<!-- Disqus Thread -->

<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'siddharthkannanblog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <!-- <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a> -->

    </div>

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YE2VZMP9F1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YE2VZMP9F1');
</script>


  </body>
</html>
